# Experiment 5: Subqueries and Views

## AIM
To study and implement subqueries and views.

## THEORY

### Subqueries
A subquery is a query inside another SQL query and is embedded in:
- WHERE clause
- HAVING clause
- FROM clause

**Types:**
- **Single-row subquery**:
  Sub queries can also return more than one value. Such results should be made use along with the operators in and any.
- **Multiple-row subquery**:
  Here more than one subquery is used. These multiple sub queries are combined by means of ‘and’ & ‘or’ keywords.
- **Correlated subquery**:
  A subquery is evaluated once for the entire parent statement whereas a correlated Sub query is evaluated once per row processed by the parent statement.

**Example:**
```sql
SELECT * FROM employees
WHERE salary > (SELECT AVG(salary) FROM employees);
```
### Views
A view is a virtual table based on the result of an SQL SELECT query.
**Create View:**
```sql
CREATE VIEW view_name AS
SELECT column1, column2 FROM table_name WHERE condition;
```
**Drop View:**
```sql
DROP VIEW view_name;
```

**Question 1**
--
From the following tables write a SQL query to count the number of customers with grades above the average in New York City. Return grade and count.

```
select grade,COUNT(*) from customer
group by grade
having grade>(
        select avg(grade) from customer
        where city="New York"
);
```

**Output:**

<img width="588" height="429" alt="image" src="https://github.com/user-attachments/assets/bcd296e3-8b01-476d-94d9-18c51b1e725d" />


**Question 2**
---
Write a SQL query to Identify customers whose city is different from the city of the customer with the highest ID



```
select * from customer
where city<>(
        select city from customer
        where id=(select max(id) from customer) 
);
```

**Output:**

<img width="1268" height="591" alt="image" src="https://github.com/user-attachments/assets/b1c4b805-10bd-4d9b-a029-37618e7aea96" />


**Question 3**
---
From the following tables, write a SQL query to find those salespeople who earned the maximum commission. Return ord_no, purch_amt, ord_date, and salesman_id.
```
select ord_no, purch_amt, ord_date, salesman_id from orders
where salesman_id in(
        select salesman_id from salesman
        where commission=(select max(commission) from salesman)
);
```

**Output:**

<img width="1062" height="561" alt="image" src="https://github.com/user-attachments/assets/ab06af66-1f99-4823-b0f5-3dd07e1d81f9" />

**Question 4**
---

From the following tables write a SQL query to find all orders generated by New York-based salespeople. Return ord_no, purch_amt, ord_date, customer_id, salesman_id.
```
select ord_no, purch_amt, ord_date, customer_id, salesman_id from orders
where salesman_id in(
        select salesman_id from salesman
        where city="New York"
);
```

**Output:**

<img width="1275" height="537" alt="Screenshot 2025-11-25 192007" src="https://github.com/user-attachments/assets/8bedc116-9f5d-435c-87dc-ee6f1c37042f" />


**Question 5**
---
From the following tables write a SQL query to find salespeople who had more than one customer. Return salesman_id and name.

```
select salesman_id,name from salesman
where salesman_id in(
        select salesman_id from customer
        group by salesman_id having count(customer_id)>1 
);
```

**Output:**

<img width="620" height="566" alt="image" src="https://github.com/user-attachments/assets/456fc5a0-61ba-49c1-a674-c6f1726fd6a0" />


**Question 6**
---
Write a SQL query to Retrieve the names of customers who have a phone number that is not shared with any other customer.


```
select name from customer
where phone in(
        select phone from customer
        group by phone having count(phone)=1
);
```

**Output:**

<img width="517" height="554" alt="image" src="https://github.com/user-attachments/assets/7cbd4d7c-032d-41a7-8c4c-ee1df17d8923" />


**Question 7**
---
From the following tables write a SQL query to find all orders generated by London-based salespeople. Return ord_no, purch_amt, ord_date, customer_id, salesman_id.

```
select ord_no, purch_amt, ord_date, customer_id, salesman_id from orders
where salesman_id in(
            select salesman_id from salesman 
            where city="London"
);
```

**Output:**

<img width="1270" height="487" alt="image" src="https://github.com/user-attachments/assets/8b9f212b-bb38-4f90-877d-2e6022996994" />


**Question 8**
---
Write a SQL query to retrieve all columns from the CUSTOMERS table for customers whose salary is EQUAL TO $1500

```
select * from CUSTOMERS
WHERE salary=1500;
```

**Output:**

<img width="1254" height="428" alt="image" src="https://github.com/user-attachments/assets/b2519bdd-ba0e-47ec-b7a6-9a1a2b06d262" />


**Question 9**
---
Write a SQL query that retrieve all the columns from the table "Grades", where the grade is equal to the maximum grade achieved in each subject.

```
select * from GRADES
WHERE grade=(
        select max(grade) from GRADES as g2
        where g2.subject = GRADES.subject
);
```

**Output:**

<img width="1267" height="529" alt="image" src="https://github.com/user-attachments/assets/0b737d41-8ff2-4b47-9b65-0407d2c4aa45" />


**Question 10**
---
Write a query to display all the customers whose ID is the difference between the salesperson ID of Mc Lyon and 2001.

```
select * from customer
where customer_id=(
        select salesman_id-2001 from salesman
        where name="Mc Lyon"
);

```

**Output:**

<img width="1265" height="401" alt="image" src="https://github.com/user-attachments/assets/85ba1395-f4c8-48cc-a862-c7613794eb36" />

![WhatsApp Image 2025-11-22 at 22 48 41_121b7a62](https://github.com/user-attachments/assets/d7322e39-83fc-4db5-badc-2c5618ed5c20)



## RESULT
Thus, the SQL queries to implement subqueries and views have been executed successfully.
